{"id":"components/variants/index.jsx","dependencies":[{"name":"/Users/lucascosta/jobs/tray/taitamariki_5.0/package.json","includedInParent":true,"mtime":1578496610234},{"name":"react","loc":{"line":1,"column":44},"parent":"/Users/lucascosta/jobs/tray/taitamariki_5.0/app/components/variants/index.jsx","resolved":"/Users/lucascosta/jobs/tray/taitamariki_5.0/node_modules/react/index.js"},{"name":"react-redux","loc":{"line":2,"column":24},"parent":"/Users/lucascosta/jobs/tray/taitamariki_5.0/app/components/variants/index.jsx","resolved":"/Users/lucascosta/jobs/tray/taitamariki_5.0/node_modules/react-redux/es/index.js"},{"name":"axios","loc":{"line":3,"column":18},"parent":"/Users/lucascosta/jobs/tray/taitamariki_5.0/app/components/variants/index.jsx","resolved":"/Users/lucascosta/jobs/tray/taitamariki_5.0/node_modules/axios/index.js"},{"name":"../../actions","loc":{"line":5,"column":71},"parent":"/Users/lucascosta/jobs/tray/taitamariki_5.0/app/components/variants/index.jsx","resolved":"/Users/lucascosta/jobs/tray/taitamariki_5.0/app/actions/index.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nvar _actions = require(\"../../actions\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; if (obj != null) { var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nvar Variants =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Variants, _Component);\n\n  function Variants(props) {\n    var _this;\n\n    _classCallCheck(this, Variants);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Variants).call(this, props));\n    _this.state = {\n      variants: [],\n      selected: [],\n      selects: [],\n      type: [],\n      filter: [],\n      product: {\n        price: 0,\n        offer: 0,\n        payment: '',\n        images: []\n      }\n    };\n    return _this;\n  }\n\n  _createClass(Variants, [{\n    key: \"init\",\n    value: function init(data) {\n      var _this2 = this;\n\n      var variants = data.Variants.map(function (item) {\n        var payment;\n\n        if (item.Variant.payment_option_details.length) {\n          payment = '<span>' + item.Variant.payment_option_details[0].plots + 'x</span> de <span>' + new Intl.NumberFormat('pt-br', {\n            style: 'currency',\n            currency: 'BRL'\n          }).format(item.Variant.payment_option_details[0].value) + '</span>';\n        }\n\n        return {\n          id: item.Variant.id,\n          skus: item.Variant.Sku,\n          availabled: parseInt(item.Variant.available) == 1 ? true : false,\n          price: item.Variant.price,\n          offer: item.Variant.promotional_price,\n          payment: payment,\n          images: item.Variant.VariantImage.map(function (image) {\n            return image.http.replace('http:', '');\n          })\n        };\n      });\n      var type = variants.map(function (variant) {\n        return variant.skus.map(function (sku) {\n          return sku.type;\n        });\n      });\n      var aux = [];\n      type.forEach(function (item) {\n        aux = aux.concat(item);\n      });\n      type = aux;\n      type = type.filter(function (element, index, self) {\n        return index == type.indexOf(element);\n      });\n      var selects = [];\n      type.forEach(function (name, index) {\n        var options = _this2.options(name, variants);\n\n        selects.push({\n          name: name,\n          options: options,\n          disabled: index <= 0 ? false : true\n        });\n      });\n      this.setState({\n        variants: variants,\n        type: type,\n        selects: selects,\n        filter: variants,\n        product: {\n          price: this.props.price,\n          offer: this.props.offer,\n          payment: this.props.payment,\n          images: this.props.images,\n          availabled: this.props.availabled,\n          saleable: this.props.saleable\n        }\n      });\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      var _this3 = this;\n\n      _axios.default.get('/web_api/variants/?product_id=' + this.props.id).then(function (request) {\n        return request.data;\n      }).then(function (data) {\n        return _this3.init(data);\n      });\n    }\n  }, {\n    key: \"options\",\n    value: function options(type) {\n      var variants = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.state.variants;\n      var skus = variants.map(function (variant) {\n        return variant.skus;\n      });\n      var options = skus;\n      var aux = [];\n      options.forEach(function (item) {\n        aux = aux.concat(item);\n      });\n      options = aux;\n      options = options.filter(function (sku) {\n        return sku.type == type;\n      }).map(function (sku) {\n        return sku.value;\n      });\n      aux = options;\n      options = options.filter(function (element, index) {\n        return index == aux.indexOf(element);\n      }).map(function (option) {\n        var image = '';\n        skus.forEach(function (item) {\n          var isImage = item.filter(function (sku) {\n            return sku.value == option && sku.image;\n          });\n\n          if (isImage.length) {\n            image = isImage[0].image.replace('http:', '');\n          }\n        });\n        return {\n          value: option,\n          label: option,\n          image: image,\n          disabled: false,\n          selected: false\n        };\n      });\n      return this.props.type == 'close' ? [].concat([{\n        value: '',\n        label: \"Selecione\",\n        selected: true,\n        image: ''\n      }], options) : options;\n    }\n  }, {\n    key: \"filter\",\n    value: function filter(selects) {\n      var filter = this.state.variants;\n      selects.forEach(function (select) {\n        filter = filter.filter(function (variant) {\n          return variant.skus.filter(function (item) {\n            return item.type == select.type && item.value == select.value;\n          }).length > 0;\n        });\n      });\n      return filter;\n    }\n  }, {\n    key: \"change\",\n    value: function change(index, value) {\n      var selects = this.state.selects;\n      var selected = this.state.selected;\n      var count = this.state.selects.length - 1;\n      var has = selected.filter(function (item) {\n        return item.type == selects[index].name;\n      });\n      var filter = []; // Default value\n\n      var price = this.state.product.price;\n      var offer = this.state.product.offer;\n      var payment = this.state.product.payment;\n      var images = this.state.product.images;\n      var availabled = this.state.product.availabled;\n      var saleable = this.state.product.saleable;\n      this.props.resetBuy();\n      selects.forEach(function (select, key) {\n        if (index == key) select.options.filter(function (item) {\n          if (item.value == value) item.selected = true;else item.selected = false;\n          return true;\n        });else if (key > index) {\n          select.disabled = true;\n          select.options.filter(function (item) {\n            if (item.value == '') item.selected = true;else item.selected = false;\n            return true;\n          });\n        }\n      });\n      if (index + 1 <= count) selected = selected.slice(index, count);\n\n      if (has.length) {\n        selected = selected.map(function (item) {\n          if (item.type == selects[index].name) return {\n            type: selects[index].name,\n            value: value\n          };else return {\n            type: item.type,\n            value: item.value\n          };\n        });\n      } else selected.push({\n        type: selects[index].name,\n        value: value\n      });\n\n      if (value == \"\") {\n        if (index + 1 <= count) {\n          this.props.setSku({});\n          availabled = false;\n          selects[index + 1].disabled = true;\n          selects[index + 1].options.forEach(function (option, index) {\n            if (index == 0) option.selected = true;else option.selected = false;\n          });\n        }\n      } else {\n        if (index + 1 <= count) {\n          var variants = this.filter(selected);\n          selects[index + 1].disabled = false;\n          selects[index + 1].options = this.options(selects[index + 1].name, variants);\n        }\n      }\n\n      if (selected.length == this.state.type.length) {\n        filter = this.filter(selected);\n\n        if (filter.length) {\n          price = parseFloat(filter[0].price);\n          offer = parseFloat(filter[0].offer);\n          payment = filter[0].payment;\n          images = filter[0].images;\n          availabled = filter[0].availabled;\n          saleable = true;\n          this.props.setSku(filter[0]);\n        }\n      }\n\n      payment = payment ? payment : '';\n      this.props.setAttributes(price, offer, payment, images, availabled, saleable);\n      this.setState({\n        selects: selects,\n        selected: selected,\n        filter: filter\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var variants = this.state.variants;\n      var selects = this.state.selects;\n      if (!variants.length) return _react.default.createElement(\"div\", {\n        className: \"variants\"\n      });\n      if (this.props.type == 'close') return _react.default.createElement(\"div\", {\n        className: \"variants variants--close\"\n      }, selects.map(function (select, key) {\n        return _react.default.createElement(\"div\", {\n          key: key,\n          className: select.disabled ? 'disabled variant' : 'variant'\n        }, _react.default.createElement(\"label\", {\n          htmlFor: 'variant-' + key\n        }, select.name), _react.default.createElement(\"select\", {\n          disabled: select.disabled,\n          value: select.options.filter(function (item) {\n            return item.selected;\n          })[0].value,\n          onChange: function onChange(e) {\n            _this4.change(key, e.target.value);\n          },\n          name: 'variant-' + key,\n          id: 'variant-' + key\n        }, select.options.map(function (option, index) {\n          return _react.default.createElement(\"option\", {\n            disabled: option.disabled,\n            key: index + 1,\n            value: option.value\n          }, option.label);\n        })));\n      }));else if (this.props.type == 'radio') return _react.default.createElement(\"div\", {\n        className: \"variants variants--radio\"\n      }, selects.map(function (select, key) {\n        return _react.default.createElement(\"div\", {\n          key: key,\n          className: select.disabled ? 'disabled' : ''\n        }, _react.default.createElement(\"h3\", {\n          className: \"variant__title\"\n        }, select.name), _react.default.createElement(\"div\", {\n          className: \"variant\",\n          \"aria-disabled\": select.disabled\n        }, select.options.map(function (option, index) {\n          return _react.default.createElement(\"label\", {\n            key: 'label-' + key + '-' + index,\n            className: \"variant__item\",\n            \"aria-disabled\": option.disabled\n          }, _react.default.createElement(\"input\", {\n            className: \"variant__radio\",\n            type: \"radio\",\n            onChange: function onChange(e) {\n              _this4.change(key, e.target.value);\n            },\n            name: 'variant[' + key + ']',\n            disabled: option.disabled,\n            checked: option.selected,\n            key: index + 1,\n            value: option.value\n          }), option.image ? _react.default.createElement(\"span\", {\n            className: \"variant__label variant__label--image\"\n          }, _react.default.createElement(\"img\", {\n            src: option.image,\n            alt: option.label\n          })) : _react.default.createElement(\"span\", {\n            className: \"variant__label\"\n          }, option.label));\n        })));\n      }));else return _react.default.createElement(\"div\", {\n        className: \"variants variants--open\"\n      }, selects.map(function (select, key) {\n        return _react.default.createElement(\"div\", {\n          key: key,\n          className: select.disabled ? 'disabled' : ''\n        }, _react.default.createElement(\"h3\", {\n          className: \"variant__title\"\n        }, select.name), _react.default.createElement(\"div\", {\n          className: \"variant\",\n          \"aria-disabled\": select.disabled\n        }, select.options.map(function (option, index) {\n          return _react.default.createElement(\"label\", {\n            key: 'label-' + key + '-' + index,\n            className: \"variant__item\",\n            \"aria-disabled\": option.disabled\n          }, _react.default.createElement(\"input\", {\n            className: \"variant__radio\",\n            type: \"radio\",\n            onChange: function onChange(e) {\n              _this4.change(key, e.target.value);\n            },\n            name: 'variant[' + key + ']',\n            disabled: option.disabled,\n            checked: option.selected,\n            key: index + 1,\n            value: option.value\n          }), option.image ? _react.default.createElement(\"span\", {\n            className: \"variant__label variant__label--image \"\n          }, _react.default.createElement(\"img\", {\n            src: option.image,\n            alt: option.label\n          })) : _react.default.createElement(\"span\", {\n            className: \"variant__label\"\n          }, option.label));\n        })));\n      }));\n    }\n  }]);\n\n  return Variants;\n}(_react.Component);\n\nVariants.propTypes = {};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {};\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setAttributes: function setAttributes(price, offer, payment, images, availabled, saleable) {\n      return dispatch((0, _actions.quickviewAttributes)(price, offer, payment, images, availabled, saleable));\n    },\n    setSku: function setSku(sku) {\n      return dispatch((0, _actions.quickviewSetSkuSelected)(sku));\n    },\n    resetBuy: function resetBuy() {\n      return dispatch((0, _actions.resetBuy)());\n    }\n  };\n};\n\nvar _default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(Variants);\n\nexports.default = _default;"},"sourceMaps":null,"error":null,"hash":"2ec73b991b9df0c8554063f21131484a","cacheData":{"env":{}}}